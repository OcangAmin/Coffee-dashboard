<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Kasir Nasi Kuning 51</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{
    font-family: Arial, sans-serif;
    background:#f4f6f8;
    margin:0;
    padding:15px;
}
.container{
    max-width:900px;
    margin:auto;
    background:#fff;
    padding:20px;
    border-radius:12px;
    box-shadow:0 4px 10px rgba(0,0,0,.1);
}
.header{
    text-align:center;
    margin-bottom:15px;
}
.header h1{
    margin:0;
}
.row{
    display:flex;
    gap:10px;
    margin-bottom:10px;
    flex-wrap:wrap;
}
select,input,button{
    padding:10px;
    font-size:14px;
}
button{
    cursor:pointer;
    border:none;
    border-radius:6px;
}
.add{background:#0d6efd;color:#fff}
.cash{background:#198754;color:#fff}
.qris{background:#6f42c1;color:#fff}
.save{background:#fd7e14;color:#fff;width:100%}
table{
    width:100%;
    border-collapse:collapse;
    margin-top:10px;
}
th,td{
    border:1px solid #ddd;
    padding:8px;
    text-align:center;
}
th{
    background:#f1f1f1;
}
.total{
    font-size:18px;
    font-weight:bold;
    text-align:right;
}
</style>
</head>

<body>
<div class="container">

<div class="header">
    <h1>üçö Nasi Kuning 51</h1>
    <small>Aplikasi Kasir Manual</small>
</div>

<!-- INPUT MENU -->
<div class="row">
<select id="menu">
<option value="" disabled selected>Pilih Menu</option>
<option value="Ikan|5000">Ikan - 5000</option>
<option value="Bakwan|2000">Bakwan - 2000</option>
<option value="Nasi|5000">Nasi - 5000</option>
<option value="Ayam|5000">Ayam - 5000</option>
<option value="Nasi Kuning Ayam|15000">Nasi Kuning Ayam - 15000</option>
<option value="Nasi Kuning Ikan|13000">Nasi Kuning Ikan - 13000</option>
<option value="Nasi Kuning Telur|10000">Nasi Kuning Telur - 10000</option>
<option value="Nasi Kuning Ayam Telur|23000">Nasi Kuning Ayam Telur - 23000</option>
<option value="Nasi Kuning Ikan Telur|20000">Nasi Kuning Ikan Telur - 20000</option>
<option value="Air Mineral|5000">Air Mineral - 5000</option>
</select>

<input type="number" id="qty" placeholder="Qty" value="1" min="1">
<button class="add" onclick="tambah()">Tambah</button>
</div>

<!-- CART -->
<table>
<thead>
<tr>
<th>Menu</th>
<th>Qty</th>
<th>Subtotal</th>
</tr>
</thead>
<tbody id="cart"></tbody>
</table>

<p class="total">Total: Rp <span id="total">0</span></p>

<!-- PEMBAYARAN -->
<div class="row">
<button class="cash" onclick="setMetode('CASH')">CASH</button>
<button class="qris" onclick="setMetode('QRIS')">QRIS</button>
<input type="number" id="bayar" placeholder="Uang Bayar">
</div>

<p>Metode: <b id="metode">-</b></p>

<button class="save" onclick="simpanTransaksi()">üíæ Save Histori Pembayaran</button>

<!-- HISTORI -->
<h3>üìú Histori Transaksi</h3>
<table>
<thead>
<tr>
<th>Tanggal</th>
<th>Waktu</th>
<th>Metode</th>
<th>Total</th>
<th>Bayar</th>
<th>Kembalian</th>
</tr>
</thead>
<tbody id="histori"></tbody>
</table>

</div>

<script>
let total = 0;
let metode = "";

function tambah(){
    const menu = document.getElementById("menu").value;
    if(!menu) return;

    const [nama,harga] = menu.split("|");
    const qty = +document.getElementById("qty").value;
    const subtotal = harga * qty;

    const tr = document.createElement("tr");
    tr.innerHTML = `<td>${nama}</td><td>${qty}</td><td>${subtotal}</td>`;
    document.getElementById("cart").appendChild(tr);

    total += subtotal;
    document.getElementById("total").innerText = total;
}

function setMetode(m){
    metode = m;
    document.getElementById("metode").innerText = m;
    if(m==="QRIS"){
        document.getElementById("bayar").value = total;
        document.getElementById("bayar").disabled = true;
    }else{
        document.getElementById("bayar").disabled = false;
        document.getElementById("bayar").value = "";
    }
}

function simpanTransaksi(){
    if(total===0) return alert("Belum ada transaksi");
    if(!metode) return alert("Pilih metode pembayaran");

    const bayar = +document.getElementById("bayar").value;
    if(metode==="CASH" && bayar < total) return alert("Uang kurang");

    const kembali = bayar - total;
    const now = new Date();
    const tgl = now.toLocaleDateString("id-ID");
    const jam = now.toLocaleTimeString("id-ID");

    // tampil histori
    const tr = document.createElement("tr");
    tr.innerHTML = `
        <td>${tgl}</td>
        <td>${jam}</td>
        <td>${metode}</td>
        <td>${total}</td>
        <td>${bayar}</td>
        <td>${kembali}</td>`;
    document.getElementById("histori").appendChild(tr);

    // simpan ke file CSV
    const fileName = `kasir-nasi-kuning-51-${now.toISOString().slice(0,10)}.csv`;
    let csv = localStorage.getItem(fileName) || 
    "Tanggal,Waktu,Metode,Total,Bayar,Kembalian\n";

    csv += `${tgl},${jam},${metode},${total},${bayar},${kembali}\n`;
    localStorage.setItem(fileName,csv);

    const blob = new Blob([csv],{type:"text/csv"});
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = fileName;
    a.click();

    reset();
}

function reset(){
    document.getElementById("cart").innerHTML="";
    document.getElementById("total").innerText="0";
    document.getElementById("bayar").value="";
    document.getElementById("metode").innerText="-";
    total=0;
    metode="";
}
</script>

</body>
</html>
