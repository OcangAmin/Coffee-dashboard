<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Kasir Nasi Kuning 51</title>
<style>
*{box-sizing:border-box;font-family:Arial}
body{margin:0;background:#f2f2f2}
header{background:#ff9800;color:#fff;text-align:center;padding:12px;font-weight:bold;position:sticky;top:0;z-index:2}
.container{padding:10px}
.section{background:#fff;border-radius:10px;padding:10px;margin-top:10px;box-shadow:0 2px 6px rgba(0,0,0,0.1)}
.section h3{margin:0 0 8px 0}
.menu-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:8px}
.menu-btn{padding:12px;border:none;border-radius:10px;background:linear-gradient(145deg,#fff,#e6e6e6);font-weight:bold;box-shadow:0 1px 4px rgba(0,0,0,0.2);font-size:14px}
.menu-btn:active{transform:scale(.98)}
.cart-item{display:flex;justify-content:space-between;align-items:center;margin-bottom:6px}
.cart-item .left{flex:1}
.cart-item .right{display:flex;gap:6px;align-items:center}
.small-btn{padding:6px 10px;border:none;border-radius:8px;background:#e0e0e0;font-weight:bold}
.small-btn:active{transform:scale(.98)}
.del-btn{background:#f44336;color:#fff}
.payment-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:8px}
.pay-btn{padding:12px;border:none;border-radius:10px;font-weight:bold}
.pay-btn.active{background:#4caf50;color:#fff}
.nominal-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-top:8px}
.nom-btn{padding:12px;border:none;border-radius:10px;font-weight:bold;background:linear-gradient(145deg,#fff,#e6e6e6)}
.nom-btn:active{transform:scale(.98)}
input[type=number]{width:100%;padding:10px;font-size:16px;border:1px solid #ddd;border-radius:10px}
.footer{position:fixed;bottom:0;left:0;width:100%;background:#fff;padding:10px;box-shadow:0 -2px 6px rgba(0,0,0,0.15)}
.footer .row{display:flex;gap:8px}
.footer button{flex:1;padding:12px;border:none;border-radius:10px;font-weight:bold}
.save-btn{background:#2196f3;color:#fff}
.reset-btn{background:#f44336;color:#fff}
</style>
</head>
<body>

<header>Kasir Nasi Kuning 51</header>

<div class="container">

  <!-- MENU UTAMA (NASI KUNING) -->
  <div class="section">
    <h3>Menu Utama (Nasi Kuning)</h3>
    <div class="menu-grid" id="menuUtama"></div>
  </div>

  <!-- MENU ADDITIONAL -->
  <div class="section">
    <h3>Menu Additional</h3>
    <div class="menu-grid" id="menuAdditional"></div>
  </div>

  <!-- CART -->
  <div class="section">
    <h3>Pesanan</h3>
    <div id="cart"></div>
    <hr>
    <div><b>Total Item:</b> <span id="totalItem">0</span></div>
    <div><b>Total Harga:</b> Rp <span id="totalPrice">0</span></div>
  </div>

  <!-- PAYMENT -->
  <div class="section">
    <h3>Pembayaran</h3>
    <div class="payment-grid">
      <button class="pay-btn" id="cashBtn" onclick="setMethod('cash')">Cash</button>
      <button class="pay-btn" id="qrisBtn" onclick="setMethod('qris')">QRIS</button>
    </div>

    <div style="margin-top:8px">
      <input id="paid" type="number" placeholder="Uang Bayar" inputmode="numeric" oninput="calc()" />
    </div>

    <div class="nominal-grid">
      <button class="nom-btn" onclick="addPaid(5000)">5000</button>
      <button class="nom-btn" onclick="addPaid(10000)">10000</button>
      <button class="nom-btn" onclick="addPaid(20000)">20000</button>
      <button class="nom-btn" onclick="addPaid(50000)">50000</button>
      <button class="nom-btn" onclick="addPaid(100000)">100000</button>
      <button class="nom-btn" onclick="setPaidExact()">Uang Pas</button>
    </div>

    <div style="margin-top:8px">
      <div><b>Kembalian:</b> Rp <span id="change">0</span></div>
      <div><b>Status:</b> <span id="status">Belum bayar</span></div>
    </div>
  </div>

  <!-- HISTORY -->
  <div class="section">
    <h3>History Transaksi</h3>
    <div id="history"></div>
    <button class="save-btn" style="width:100%;margin-top:8px" onclick="saveHistory()">Simpan History (File)</button>
  </div>

</div>

<div class="footer">
  <div class="row">
    <button class="save-btn" onclick="finishTransaction()">Selesaikan Transaksi</button>
    <button class="reset-btn" onclick="closeCashier()">Tutup Kasir</button>
  </div>
</div>

<script>
const menusUtama = [
  {name:"Nasi kuning ayam", price:15000},
  {name:"Nasi kuning ikan", price:13000},
  {name:"Nasi kuning telur", price:10000},
  {name:"Nasi kuning ayam telur", price:23000},
  {name:"Nasi kuning ikan telur", price:20000},
];

const menusAdditional = [
  {name:"Ikan", price:5000},
  {name:"Bakwan", price:2000},
  {name:"Nasi", price:5000},
  {name:"Telur", price:5000},
  {name:"Ayam", price:5000},
  {name:"Air mineral", price:5000},
];

let cart = JSON.parse(localStorage.getItem("cart")) || {};
let history = JSON.parse(localStorage.getItem("history")) || [];
let method = localStorage.getItem("method") || "";
let paid = 0;

function renderMenus(){
  const m1=document.getElementById("menuUtama");
  const m2=document.getElementById("menuAdditional");

  menusUtama.forEach(m=>{
    const btn=document.createElement("button");
    btn.className="menu-btn";
    btn.innerText=`${m.name}\nRp ${m.price}`;
    btn.onclick=()=>addToCart(m.name);
    m1.appendChild(btn);
  });

  menusAdditional.forEach(m=>{
    const btn=document.createElement("button");
    btn.className="menu-btn";
    btn.innerText=`${m.name}\nRp ${m.price}`;
    btn.onclick=()=>addToCart(m.name);
    m2.appendChild(btn);
  });
}

function addToCart(name){
  cart[name] = (cart[name] || 0) + 1;
  saveCart();
  renderCart();
}

function saveCart(){
  localStorage.setItem("cart", JSON.stringify(cart));
}

function renderCart(){
  const c=document.getElementById("cart");
  c.innerHTML="";
  let totalItem=0;
  let totalPrice=0;

  for(let name in cart){
    const qty=cart[name];
    const menu=menusUtama.concat(menusAdditional).find(x=>x.name===name);
    const sub=menu.price*qty;
    totalItem += qty;
    totalPrice += sub;

    c.innerHTML += `
      <div class="cart-item">
        <div class="left">
          <b>${name}</b><br>
          Rp ${sub}
        </div>
        <div class="right">
          <button class="small-btn" onclick="decrease('${name}')">-</button>
          <span>${qty}</span>
          <button class="small-btn" onclick="increase('${name}')">+</button>
          <button class="small-btn del-btn" onclick="removeItem('${name}')">X</button>
        </div>
      </div>
    `;
  }

  document.getElementById("totalItem").innerText=totalItem;
  document.getElementById("totalPrice").innerText=totalPrice;
  calc();
}

function increase(name){
  cart[name] = (cart[name] || 0) + 1;
  saveCart();
  renderCart();
}

function decrease(name){
  if(!cart[name]) return;
  cart[name]--;
  if(cart[name] <= 0) delete cart[name];
  saveCart();
  renderCart();
}

function removeItem(name){
  delete cart[name];
  saveCart();
  renderCart();
}

function setMethod(m){
  method=m;
  localStorage.setItem("method", m);
  document.getElementById("cashBtn").classList.remove("active");
  document.getElementById("qrisBtn").classList.remove("active");
  if(m==="cash") document.getElementById("cashBtn").classList.add("active");
  if(m==="qris") document.getElementById("qrisBtn").classList.add("active");
  calc();
}

function calc(){
  const total = parseInt(document.getElementById("totalPrice").innerText) || 0;
  paid = parseInt(document.getElementById("paid").value) || 0;

  if(method==="qris"){
    paid = total;
    document.getElementById("paid").value = paid;
  }

  const change = paid - total;
  document.getElementById("change").innerText = change < 0 ? 0 : change;

  if(total === 0){
    document.getElementById("status").innerText="Belum ada pesanan";
    return;
  }

  if(method===""){
    document.getElementById("status").innerText="Pilih metode pembayaran";
    return;
  }

  if(change < 0){
    document.getElementById("status").innerText="Uang kurang";
  } else {
    document.getElementById("status").innerText="Siap bayar";
  }
}

function addPaid(val){
  let cur = parseInt(document.getElementById("paid").value) || 0;
  cur += val;
  document.getElementById("paid").value = cur;
  calc();
}

function setPaidExact(){
  const total = parseInt(document.getElementById("totalPrice").innerText) || 0;
  document.getElementById("paid").value = total;
  calc();
}

function finishTransaction(){
  const total = parseInt(document.getElementById("totalPrice").innerText) || 0;
  const change = parseInt(document.getElementById("change").innerText) || 0;
  const status = document.getElementById("status").innerText;

  if(total === 0){
    alert("Belum ada pesanan.");
    return;
  }
  if(method === ""){
    alert("Pilih metode pembayaran.");
    return;
  }
  if(status === "Uang kurang"){
    alert("Uang bayar belum mencukupi.");
    return;
  }

  const now = new Date();
  const time = now.toLocaleString();
  const items = Object.keys(cart).map(k=>`${k} x${cart[k]}`).join(", ");

  const trx = {
    time,
    items,
    total,
    method,
    paid,
    change
  };

  history.push(trx);
  localStorage.setItem("history", JSON.stringify(history));

  cart = {};
  saveCart();
  renderCart();
  renderHistory();
  document.getElementById("paid").value="";
  calc();
}

function renderHistory(){
  const h=document.getElementById("history");
  h.innerHTML="";
  history.forEach((t,i)=>{
    h.innerHTML += `
      <div style="margin-bottom:6px">
        <b>#${i+1} - ${t.time}</b><br>
        ${t.items}<br>
        Total: Rp ${t.total} | Metode: ${t.method} | Bayar: Rp ${t.paid} | Kembali: Rp ${t.change}
      </div>
      <hr>
    `;
  });
}

function saveHistory(){
  const now = new Date();
  const filename = `bucek_history_${now.getTime()}.txt`;
  const content = history.map(t=>{
    return `${t.time} | ${t.items} | Total:${t.total} | Metode:${t.method} | Bayar:${t.paid} | Kembali:${t.change}`;
  }).join("\n");

  const blob = new Blob([content], {type:"text/plain"});
  const link = document.createElement("a");
  link.href = URL.createObjectURL(blob);
  link.download = filename;
  link.click();
  URL.revokeObjectURL(link.href);
}

function closeCashier(){
  saveHistory();
  history = [];
  localStorage.setItem("history", JSON.stringify(history));
  renderHistory();
  alert("Kasir ditutup dan history tersimpan.");
}

renderMenus();
renderCart();
renderHistory();
setMethod(method);
</script>

</body>
</html>
