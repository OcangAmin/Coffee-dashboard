<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Kasir Nasi Kuning 51</title>

<style>
body{font-family:Arial;background:#f4f4f4;margin:0;padding:10px}
h2,h3{margin:6px 0}
.box{background:#fff;padding:12px;border-radius:10px;margin-bottom:12px}
button{padding:10px;border:none;border-radius:8px;font-size:14px;cursor:pointer}
.menu-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:8px}
.menu-btn{background:#ffc107;font-weight:bold}
.metode-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:8px;margin-top:6px}
.metode-btn{background:#dee2e6}
.metode-aktif{background:#0d6efd;color:#fff}
.nominal-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-top:6px}
.nominal-btn{background:#198754;color:#fff;font-weight:bold}
.hapus{background:#dc3545;color:#fff}
.simpan{background:#0d6efd;color:#fff;width:100%;margin-top:8px}
.owner{background:#343a40;color:#fff;width:100%;margin-top:8px}
table{width:100%;border-collapse:collapse}
td,th{border-bottom:1px solid #ddd;padding:6px;text-align:center}
input{width:100%;padding:8px;margin-top:6px;font-size:16px}
.summary{background:#e9ecef;padding:8px;border-radius:8px}
</style>
</head>

<body>

<h2>üçõ Kasir Nasi Kuning 51</h2>

<div class="box">
<h3>Menu</h3>
<div id="menu" class="menu-grid"></div>
</div>

<div class="box">
<h3>Transaksi</h3>
<table id="tabel">
<tr><th>Menu</th><th>Qty</th><th>Subtotal</th><th></th></tr>
</table>

<h3>Total: Rp <span id="total">0</span></h3>

<h3>Metode Pembayaran</h3>
<div class="metode-grid">
  <button id="btnCash" class="metode-btn" onclick="pilihMetode('Cash')">CASH</button>
  <button id="btnQris" class="metode-btn" onclick="pilihMetode('QRIS')">QRIS</button>
</div>

<input type="number" id="bayar" placeholder="Uang dibayar" oninput="hitungKembalian()">

<div class="nominal-grid">
  <button class="nominal-btn" onclick="setBayar(5000)">5.000</button>
  <button class="nominal-btn" onclick="setBayar(10000)">10.000</button>
  <button class="nominal-btn" onclick="setBayar(20000)">20.000</button>
  <button class="nominal-btn" onclick="setBayar(50000)">50.000</button>
  <button class="nominal-btn" onclick="setBayar(100000)">100.000</button>
  <button class="nominal-btn" onclick="uangPas()">UANG PAS</button>
</div>

<h3>Kembalian: Rp <span id="kembali">0</span></h3>

<button class="simpan" onclick="selesaikanTransaksi()">‚úî Selesaikan Transaksi</button>
</div>

<div class="box">
<h3>üìú Histori Pembayaran</h3>
<div id="histori"></div>

<button class="simpan" onclick="simpanKeFile()">üíæ Simpan Laporan Sementara</button>
<button class="owner" onclick="tutupKasir()">üîí Tutup Kasir</button>
</div>

<div class="box summary">
<b>üìä Rekap</b><br>
Transaksi: <span id="rJml">0</span><br>
Omzet: Rp <span id="rOmzet">0</span><br>
Kembalian: Rp <span id="rKembali">0</span>
</div>

<script>
const menuData=[
["Ikan",5000],["Bakwan",2000],["Nasi",5000],["Telur",5000],
["Ayam",5000],["Nasi kuning ayam",15000],["Nasi kuning ikan",13000],
["Nasi kuning telur",10000],["Nasi kuning ayam telur",23000],
["Nasi kuning ikan telur",20000],["Air mineral",5000]
];

let cart=[];
let histori=JSON.parse(localStorage.getItem("historiKasir")) || [];
let metode="";

/* INIT */
menuData.forEach(m=>{
  let b=document.createElement("button");
  b.className="menu-btn";
  b.innerHTML=`${m[0]}<br>Rp${m[1]}`;
  b.onclick=()=>tambah(m[0],m[1]);
  menu.appendChild(b);
});
tampilHistori();

/* CART */
function tambah(n,h){
  let i=cart.find(c=>c.nama===n);
  i?i.qty++:cart.push({nama:n,harga:h,qty:1});
  render();
}

function hapus(n){
  cart=cart.filter(c=>c.nama!==n);
  render();
}

function render(){
  tabel.innerHTML="<tr><th>Menu</th><th>Qty</th><th>Subtotal</th><th></th></tr>";
  let t=0;
  cart.forEach(c=>{
    let s=c.harga*c.qty;
    t+=s;
    tabel.innerHTML+=`
    <tr>
      <td>${c.nama}</td>
      <td>${c.qty}</td>
      <td>${s}</td>
      <td><button class="hapus" onclick="hapus('${c.nama}')">X</button></td>
    </tr>`;
  });
  total.innerText=t;
  hitungKembalian();
}

/* PAYMENT */
function pilihMetode(m){
  metode=m;
  btnCash.classList.remove("metode-aktif");
  btnQris.classList.remove("metode-aktif");
  m==="Cash"?btnCash.classList.add("metode-aktif"):btnQris.classList.add("metode-aktif");
  if(m==="QRIS") uangPas();
}

function setBayar(n){
  bayar.value=Number(n);
  hitungKembalian();
}

function uangPas(){
  bayar.value=Number(total.innerText);
  hitungKembalian();
}

function hitungKembalian(){
  let k=Number(bayar.value)-Number(total.innerText);
  kembali.innerText=k>0?k:0;
}

/* TRANSACTION */
function selesaikanTransaksi(){
  if(cart.length===0 || !metode) return alert("Transaksi belum lengkap");

  histori.push({
    waktu:new Date().toLocaleString("id-ID"),
    total:Number(total.innerText),
    kembali:Number(kembali.innerText),
    metode:metode
  });

  localStorage.setItem("historiKasir",JSON.stringify(histori));
  cart=[];render();bayar.value="";kembali.innerText=0;
  tampilHistori();
}

/* HISTORI */
function tampilHistori(){
  histori.innerHTML=histori.map((h,i)=>`
    <div>${i+1}. ${h.waktu} | ${h.metode} | Rp${h.total} | Kembali Rp${h.kembali}</div>
  `).join("");
  hitungRekap();
}

function hitungRekap(){
  let o=0,k=0;
  histori.forEach(h=>{o+=h.total;k+=h.kembali});
  rJml.innerText=histori.length;
  rOmzet.innerText=o;
  rKembali.innerText=k;
}

/* FILE */
function simpanKeFile(){
  let t=new Date().toLocaleDateString("id-ID").replace(/\//g,"-");
  let isi=histori.map((h,i)=>`${i+1}. ${h.waktu} | ${h.metode} | Rp${h.total} | Kembali Rp${h.kembali}`).join("\n");
  let a=document.createElement("a");
  a.href=URL.createObjectURL(new Blob([isi],{type:"text/plain"}));
  a.download="laporan_sementara_"+t+".txt";
  a.click();
}

/* TUTUP KASIR */
function tutupKasir(){
  if(!confirm("Tutup kasir dan buat laporan akhir?")) return;

  let cash=histori.filter(h=>h.metode==="Cash").length;
  let qris=histori.filter(h=>h.metode==="QRIS").length;
  let avg=Math.round(Number(rOmzet.innerText)/Math.max(1,histori.length));

  let t=new Date().toLocaleDateString("id-ID").replace(/\//g,"-");
  let isi=`LAPORAN TUTUP KASIR - NASI KUNING 51\nTanggal: ${t}\n\nDETAIL TRANSAKSI\n`;
  histori.forEach((h,i)=>{
    isi+=`${i+1}. ${h.waktu} | ${h.metode} | Rp${h.total} | Kembali Rp${h.kembali}\n`;
  });
  isi+=`\nRINGKASAN\nTransaksi: ${histori.length}\nOmzet: Rp${rOmzet.innerText}\nKembalian: Rp${rKembali.innerText}\n`;
  isi+=`\nINSIGHT\nMetode dominan: ${cash>qris?"Cash":"QRIS"}\nRata-rata transaksi: Rp${avg}`;

  let a=document.createElement("a");
  a.href=URL.createObjectURL(new Blob([isi],{type:"text/plain"}));
  a.download="TUTUP_KASIR_"+t+".txt";
  a.click();
}
</script>

</body>
</html>
