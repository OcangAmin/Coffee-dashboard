<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Coffee Shop Dashboard V2</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  margin:0;
  font-family:-apple-system, BlinkMacSystemFont, sans-serif;
  background:#0f172a;
  color:#e5e7eb;
}
header{
  padding:16px;
  background:#22c55e;
  color:#052e16;
  font-weight:700;
}
section{
  padding:14px;
}
.card{
  background:#111827;
  border-radius:14px;
  padding:14px;
  margin-bottom:14px;
}
h2{margin-top:0;font-size:16px}
input,select,button{
  width:100%;
  padding:10px;
  margin-top:6px;
  border-radius:10px;
  border:none;
  background:#1f2933;
  color:#e5e7eb;
}
button{
  background:#22c55e;
  color:#052e16;
  font-weight:700;
}
table{
  width:100%;
  font-size:13px;
  border-collapse:collapse;
}
td,th{
  padding:6px;
  border-bottom:1px solid #374151;
}
.bad{color:#ef4444}
.good{color:#22c55e}
</style>
</head>

<body>

<header>â˜• Coffee Dashboard V2</header>

<section>

<!-- ESPRESSO -->
<div class="card">
<h2>Espresso Setting</h2>
<input id="espressoGram" type="number" placeholder="Gram / shot" value="18">
<input id="espressoML" type="number" placeholder="ML / shot" value="60">
<button onclick="saveEspresso()">Simpan</button>
</div>

<!-- BAHAN -->
<div class="card">
<h2>Bahan Baku</h2>
<input id="ingName" placeholder="Nama bahan">
<input id="ingPrice" type="number" placeholder="Harga total">
<input id="ingQty" type="number" placeholder="Isi kemasan">
<button onclick="addIngredient()">Tambah</button>
<table><tbody id="ingTable"></tbody></table>
</div>

<!-- RESEP -->
<div class="card">
<h2>Resep</h2>
<input id="recipeName" placeholder="Nama resep">
<select id="recipeIngredient"></select>
<input id="recipeQty" type="number" placeholder="Qty pakai">
<button onclick="addRecipeItem()">Tambah bahan ke resep</button>
<table><tbody id="recipeTable"></tbody></table>
</div>

<!-- MENU -->
<div class="card">
<h2>Menu</h2>
<input id="menuName" placeholder="Nama menu">
<input id="menuPrice" type="number" placeholder="Harga jual">
<button onclick="addMenu()">Tambah menu</button>
<table>
<thead>
<tr><th>Menu</th><th>HPP</th><th>Margin</th></tr>
</thead>
<tbody id="menuTable"></tbody>
</table>
</div>

</section>

<script>
let ingredients = JSON.parse(localStorage.getItem("ing"))||[];
let recipes = [];
let menus = [];

function saveEspresso(){
  localStorage.setItem("espresso",JSON.stringify({
    gram:espressoGram.value,
    ml:espressoML.value
  }));
  alert("Espresso disimpan");
}

function addIngredient(){
  ingredients.push({
    name:ingName.value,
    price:ingPrice.value/ingQty.value
  });
  localStorage.setItem("ing",JSON.stringify(ingredients));
  renderIngredients();
}

function renderIngredients(){
  ingTable.innerHTML="";
  recipeIngredient.innerHTML="";
  ingredients.forEach(i=>{
    ingTable.innerHTML+=`<tr><td>${i.name}</td><td>Rp${i.price.toFixed(0)}</td></tr>`;
    recipeIngredient.innerHTML+=`<option>${i.name}</option>`;
  });
}

function addRecipeItem(){
  const ing=ingredients.find(i=>i.name===recipeIngredient.value);
  recipes.push({name:recipeName.value, cost:ing.price*recipeQty.value});
  renderRecipes();
}

function renderRecipes(){
  recipeTable.innerHTML="";
  recipes.forEach(r=>{
    recipeTable.innerHTML+=`<tr><td>${r.name}</td><td>Rp${r.cost.toFixed(0)}</td></tr>`;
  });
}

function addMenu(){
  const hpp=recipes.reduce((a,b)=>a+b.cost,0);
  const price=menuPrice.value;
  menus.push({name:menuName.value,hpp,price});
  renderMenus();
}

function renderMenus(){
  menuTable.innerHTML="";
  menus.forEach(m=>{
    const margin=((m.price-m.hpp)/m.price*100).toFixed(1);
    menuTable.innerHTML+=`
    <tr>
      <td>${m.name}</td>
      <td>Rp${m.hpp.toFixed(0)}</td>
      <td class="${margin<60?'bad':'good'}">${margin}%</td>
    </tr>`;
  });
}

renderIngredients();
</script>

</body>
</html>