<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Kasir Nasi Kuning 51</title>

<style>
body{
  font-family: Arial, sans-serif;
  background:#f4f4f4;
  margin:0;
  padding:10px;
}
h2,h3{margin:6px 0}
.box{
  background:#fff;
  padding:12px;
  border-radius:8px;
  margin-bottom:10px;
}
button{
  padding:8px;
  border:none;
  border-radius:6px;
  margin:3px;
  cursor:pointer;
}
.menu-btn{background:#ffc107}
.hapus{background:#dc3545;color:#fff}
.simpan{background:#28a745;color:#fff;width:100%;margin-top:10px}
input,select{
  width:100%;
  padding:7px;
  margin:4px 0;
}
table{
  width:100%;
  border-collapse:collapse;
}
td,th{
  border-bottom:1px solid #ddd;
  padding:6px;
  text-align:center;
}
.hidden{display:none}
.summary{
  background:#e9ecef;
  padding:8px;
  border-radius:6px;
}
</style>
</head>

<body>

<!-- KAS AWAL -->
<div class="box" id="kasAwalBox">
  <h2>ğŸ’° Kas Awal</h2>
  <input type="number" id="kasAwal" placeholder="Masukkan kas awal">
  <button class="simpan" onclick="simpanKasAwal()">Mulai Kasir</button>
</div>

<!-- KASIR -->
<div id="kasirBox" class="hidden">

<h2>ğŸ› Kasir Nasi Kuning 51</h2>

<div class="box">
<h3>Menu</h3>
<div id="menu"></div>
</div>

<div class="box">
<h3>Transaksi</h3>
<table id="tabel">
<tr><th>Menu</th><th>Qty</th><th>Subtotal</th><th></th></tr>
</table>
<h3>Total: Rp <span id="total">0</span></h3>

<select id="metode" onchange="ubahMetode()">
<option value="">Metode Pembayaran</option>
<option value="Cash">Cash</option>
<option value="QRIS">QRIS</option>
</select>

<input type="number" id="bayar" placeholder="Uang dibayar" oninput="hitungKembali()">
<h3>Kembalian: Rp <span id="kembali">0</span></h3>
</div>

<div class="box">
<h3>ğŸ“œ Histori Penjualan (Sementara)</h3>
<div id="histori"></div>
<button class="simpan" onclick="simpanHistori()">ğŸ’¾ Simpan Histori ke File</button>
</div>

<div class="box summary">
<b>ğŸ“Š Rekap Hari Ini</b><br>
Transaksi: <span id="rJml">0</span><br>
Omzet: Rp <span id="rOmzet">0</span><br>
Kembalian: Rp <span id="rKembali">0</span>
</div>

</div>

<script>
const menuData=[
["Ikan",5000],["Bakwan",2000],["Nasi",5000],["Telur",5000],
["Ayam",5000],["Nasi kuning ayam",15000],["Nasi kuning ikan",13000],
["Nasi kuning telur",10000],["Nasi kuning ayam telur",23000],
["Nasi kuning ikan telur",20000],["Air mineral",5000]
];

let cart=[];
let histori=[];

function simpanKasAwal(){
  let kas=document.getElementById("kasAwal").value;
  if(!kas) return alert("Isi kas awal!");
  localStorage.setItem("kasAwal",kas);
  document.getElementById("kasAwalBox").classList.add("hidden");
  document.getElementById("kasirBox").classList.remove("hidden");
}

menuData.forEach(m=>{
  let b=document.createElement("button");
  b.className="menu-btn";
  b.innerText=m[0]+" Rp"+m[1];
  b.onclick=()=>tambah(m[0],m[1]);
  menu.appendChild(b);
});

function tambah(n,h){
  let i=cart.find(c=>c.nama==n);
  if(i)i.qty++;
  else cart.push({nama:n,harga:h,qty:1});
  render();
}

function hapus(n){
  cart=cart.filter(c=>c.nama!=n);
  render();
}

function render(){
  tabel.innerHTML="<tr><th>Menu</th><th>Qty</th><th>Subtotal</th><th></th></tr>";
  let t=0;
  cart.forEach(c=>{
    let s=c.harga*c.qty;
    t+=s;
    tabel.innerHTML+=`<tr>
      <td>${c.nama}</td>
      <td>${c.qty}</td>
      <td>${s}</td>
      <td><button class="hapus" onclick="hapus('${c.nama}')">X</button></td>
    </tr>`;
  });
  total.innerText=t;
  hitungKembali();
}

function ubahMetode(){
  if(metode.value=="QRIS"){
    bayar.value=total.innerText;
  }
}

function hitungKembali(){
  let k=bayar.value-total.innerText;
  kembali.innerText=k>0?k:0;
}

function simpanHistori(){
  if(cart.length==0)return alert("Transaksi kosong");
  let data={
    waktu:new Date().toLocaleString("id-ID"),
    total:+total.innerText,
    kembali:+kembali.innerText
  };
  histori.push(data);
  tampilHistori();
  simpanFile();
  cart=[];render();
}

function tampilHistori(){
  historiBox=histori.map(h=>`<div>${h.waktu} | Rp${h.total}</div>`).join("");
  histori.innerHTML=historiBox;
  hitungRekap();
}

function hitungRekap(){
  let o=0,k=0;
  histori.forEach(h=>{o+=h.total;k+=h.kembali});
  rJml.innerText=histori.length;
  rOmzet.innerText=o;
  rKembali.innerText=k;
}

function simpanFile(){
  let t=new Date().toLocaleDateString("id-ID").replace(/\//g,"-");
  let isi=`Kas Awal: Rp${localStorage.getItem("kasAwal")}\n\n`;
  histori.forEach(h=>{
    isi+=`${h.waktu} | Total Rp${h.total} | Kembali Rp${h.kembali}\n`;
  });
  isi+=`\nOmzet: Rp${rOmzet.innerText}\nKembalian: Rp${rKembali.innerText}`;
  let a=document.createElement("a");
  a.href=URL.createObjectURL(new Blob([isi],{type:"text/plain"}));
  a.download="kasir_nasi_kuning_51_"+t+".txt";
  a.click();
}
</script>

</body>
</html>
